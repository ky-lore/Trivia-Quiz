<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quiz</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
    integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
</head>

<style>
  #nightBg {
    margin-top: 100px;
    margin-right: 30%;
    margin-left: 30%;
    background-color: #3d3239;
    color: rgb(248, 238, 223);
  }

  .black-text {
    color: #3d3239;
  }

  .chosen {
    color: rgb(248, 238, 223);
    background-color:mediumseagreen;
  }

  .u-wrong {
    color: rgb(248, 238, 223);
    background-color:maroon;
  }
</style>

<body id="nightBg">
  <div class="container">
    <div id="header">
      <h1 id="introHeader">The Quiz</h1>
    </div>

    <div id="questions">

    </div><br>

    <div>
      <button type="button" class="btn btn-success">Submit Answers</button>
      <span id="score"></span>
    </div>
  </div>

  <!-- QCLyg6GuZJJMliFdYjzi4L3vat2ygETU -->

  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script>
    axios.get(`https://opentdb.com/api.php?amount=20&category=21&type=multiple`)
      .then(res => {
        //console.log(res.data.results)
        let questions = res.data.results

        let correctAnswers = [];

        for (i = 0; i < res.data.results.length; i++) {
          correctAnswers.push(res.data.results[i].correct_answer)
        }
        //console.log(correctAnswers)

        function shuffle(a) {
          var j, x, i;
          for (i = a.length - 1; i > 0; i--) {
            j = Math.floor(Math.random() * (i + 1));
            x = a[i];
            a[i] = a[j];
            a[j] = x;
          }
          return a;
        }

        questions.forEach(question => {
          let answers = [...question.incorrect_answers, question.correct_answer]
          shuffle(answers)
          //console.log(answers)


          let questionElem = document.createElement('h5')
          questionElem.innerHTML = `${question.question}`
          document.getElementById("questions").append(questionElem)
          let answerElemList = document.createElement('ol')
          document.getElementById("questions").append(answerElemList)

          for (i = 0; i < answers.length; i++) {
            let answerElem = document.createElement('li')
            answerElem.className = "list-group-item black-text"
            answerElem.innerHTML = `${answers[i]}`
            document.getElementById("questions").append(answerElem)
          }
        })

        var score = 0;
        
        document.addEventListener('click', event => {
          //var firstTry = true;
          console.log(event.target)
          //console.log(res.data)

          if (correctAnswers.includes(event.target.textContent)) {
            console.log('nice')
            //if (firstTry === true) {
              score++
            //}
            console.log(score)
            event.target.className = "list-group-item black-text chosen"
          } else if (event.target.className === "list-group-item black-text") { 
            console.log('nah')
            event.target.className = "list-group-item black-text u-wrong"
            //firstTry = false;
          }

          if (event.target.classList.contains('btn-success')) {
            var scoreTally = document.getElementById("score");
            scoreTally.style.color = "turquoise"
            scoreTally.innerHTML = `
              Your score: ${score} out of 20 (${score / 20 * 100}%)
            `
          }
        })
      })
      .catch(err => console.error(err))



  </script>
</body>

</html>